{
  "meta": {
    "$_POST": [
      {
        "type": "object",
        "name": "data",
        "sub": [
          {
            "type": "object",
            "ref": "stripe_payment_intent",
            "name": "object"
          }
        ]
      }
    ]
  },
  "exec": {
    "steps": [
      {
        "name": "balance_txn_id",
        "module": "core",
        "action": "setvalue",
        "options": {
          "value": "{{$_POST.data.object.charges.data[0].balance_transaction}}"
        },
        "meta": [],
        "outputType": "text"
      },
      {
        "name": "retrieveBalanceTransaction",
        "module": "stripe",
        "action": "retrieveBalanceTransaction",
        "options": {
          "__extra": {},
          "id": "{{balance_txn_id}}"
        },
        "outputType": "object",
        "meta": [
          {
            "name": "amount",
            "type": "number"
          },
          {
            "name": "available_on",
            "type": "number"
          },
          {
            "name": "created",
            "type": "number"
          },
          {
            "name": "currency",
            "type": "text"
          },
          {
            "name": "description",
            "type": "text"
          },
          {
            "name": "fee",
            "type": "number"
          },
          {
            "name": "fee_details",
            "type": "array",
            "sub": [
              {
                "name": "amount",
                "type": "number"
              },
              {
                "name": "application",
                "type": "text"
              },
              {
                "name": "currency",
                "type": "text"
              },
              {
                "name": "description",
                "type": "text"
              },
              {
                "name": "type",
                "type": "text"
              }
            ]
          },
          {
            "name": "id",
            "type": "text"
          },
          {
            "name": "net",
            "type": "number"
          },
          {
            "name": "object",
            "type": "text"
          },
          {
            "name": "reporting_category",
            "type": "text"
          },
          {
            "name": "source",
            "type": "text",
            "expand": [
              "stripe_balance_transaction_source"
            ]
          },
          {
            "name": "status",
            "type": "text"
          },
          {
            "name": "type",
            "type": "text"
          }
        ],
        "output": false
      },
      {
        "name": "stripe_fee",
        "module": "core",
        "action": "setvalue",
        "options": {
          "value": "{{retrieveBalanceTransaction.fee}}"
        },
        "meta": [],
        "outputType": "text",
        "output": true
      },
      {
        "name": "insert",
        "module": "dbupdater",
        "action": "insert",
        "options": {
          "connection": "scratch",
          "sql": {
            "type": "insert",
            "values": [
              {
                "table": "stripe",
                "column": "result",
                "type": "text",
                "value": "{{stripe_fee}}"
              }
            ],
            "table": "stripe",
            "returning": "id",
            "query": "INSERT INTO stripe\n(result) VALUES (:P1 /* {{stripe_fee}} */)",
            "params": [
              {
                "name": ":P1",
                "type": "expression",
                "value": "{{stripe_fee}}"
              }
            ]
          }
        },
        "meta": [
          {
            "name": "identity",
            "type": "text"
          },
          {
            "name": "affected",
            "type": "number"
          }
        ]
      }
    ]
  }
}